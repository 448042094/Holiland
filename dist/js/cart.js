require(["config"],function(){require(["jquery","template","cookie","header","footer"],function(o,r){function t(){this.products=null,this.load(),this.addListener(),this.LastPrice()}t.prototype={constructor:t,load:function(){o.cookie.json=!0;var t=this.products=o.cookie("cart")||[];if(0!==t.length){o(".cart_no").hide().siblings(".cart_has").removeClass("hidden");var i=r("cart-body-template",{products:t});o("#tbody").html(i)}else o(".cart_no").show().siblings(".cart_has").hide()},addListener:function(){o("#tbody").on("click",".btn_del",o.proxy(this.delHandler,this)),o("#tbody").on("click",".btn_down,.btn_up",o.proxy(this.AddLose,this)),o("#tbody").on("blur",".cart_num",o.proxy(this.inputHandler,this)),o(".ckAll").on("click",o.proxy(this.ckAll,this)),o("#tbody").on("click",".btn_check",o.proxy(this.ckSome,this)),o("#delAll").on("click",o.proxy(this.delAll,this))},delHandler:function(t){var i=t.target,r=o(i).parents("tr"),e=r.find(".cart_id").html();this.products=this.products.filter(function(t){return!(t.id==e)}),o.cookie("cart",this.products,{expires:10,path:"/"}),r.remove(),this.LastPrice(),0===this.products.length&&o(".cart_no").show().siblings(".cart_has").hide()},AddLose:function(t){var i=t.target,r=o(i).parents("tr"),e=r.find(".cart_id").html(),c=this.products.filter(function(t){return t.id==e})[0];if(o(i).is(".btn_down")){if(c.amount<=1)return;c.amount--}else c.amount++;o.cookie("cart",this.products,{expires:10,path:"/"}),r.find(".cart_num").val(c.amount),r.find(".cart_price").html("￥"+c.amount*c.price),this.LastPrice()},inputHandler:function(t){var i=t.target,r=o(i).parents("tr"),e=r.find(".cart_id").html(),c=this.products.filter(function(t){return t.id==e})[0],n=o(i).val();/^[1-9]\d*$/.test(n)?(c.amount=n,o.cookie("cart",this.products,{expires:10,path:"/"}),r.find(".cart_price").html("￥"+c.amount*c.price),this.LastPrice()):o(i).val(c.amount)},ckAll:function(t){var i=o(t.target).prop("checked");o(".btn_check").prop("checked",i),this.LastPrice()},ckSome:function(t){var i=o(".btn_check:checked").length===this.products.length;o(".ckAll").prop("checked",i),this.LastPrice()},LastPrice:function(){var t=0;o(".btn_check:checked").each(function(){t+=Number(o(this).parents("tr").find(".cart_price").text().slice(1))}),o(".lastPrice").html("总计￥"+t)},delAll:function(){o.cookie("cart",this.products,{expires:-1,path:"/"}),location.reload(),0===this.products.length&&o(".cart_no").show().siblings(".cart_has").hide()}},new t})});